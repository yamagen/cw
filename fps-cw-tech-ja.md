# Frequency-based PCA Semantic ID (FPS-ID)：古典語コーパスに適した軽量意味ラベリング手法

## ✅ 目的

従来の `wlsp` のような語識別システムは、意味ラベルや識別子を人手で設計する必要があり、スケーラブルで構造的な一貫性を保つのが困難でした。特に『伊勢物語』『土佐日記』『古今和歌集』といった古典語のコーパスでは、総語数が少なく、fastText のような大規模ベクトルモデルは適用できません。

そこで本提案では、**FPS-ID（Frequency-based PCA Semantic ID）** を導入します。これは、**語の共起ベクトル**を PCA によって圧縮し、意味解像度に応じた桁数を持つ**可読な意味ID**として出力する軽量で解釈可能な語識別方式です。

---

## ✅ 処理全体の流れ

```sh
% fsp input.txt | cw -k "fps-id" -digit 6 | graphviz -Tsvg -o output.svg
```

| 工程       | 内容                                                                                                         |
| ---------- | ------------------------------------------------------------------------------------------------------------ |
| `fsp`      | 古典テキストを1行ずつ読み込み、語の共起ベクトルを生成し、PCAによりFPS-IDを付与した `streamtext.jsonl` を出力 |
| `cw`       | `fps-id` の上位桁で語をグルーピングし、共起重みを算出：`cw(t1, t2) = ctf × √(idf₁ × idf₂)`                   |
| `graphviz` | 共起構造を視覚化し、意味的にまとまった語群を表示                                                             |

---

## ✅ FPS-ID の仕様

### 構造：

- ソース：古典語コーパスから得られた**語の共起行列**
- 圧縮：PCA（通常は1〜2次元）
- 出力形式：`"fps-id": "23.614729"` のような小数点付き数値文字列

### 桁数による意味の解像度：

| 桁数         | 意味                                     | 用途                       |
| ------------ | ---------------------------------------- | -------------------------- |
| `23`         | 粗い意味クラスタ（例：季節語、動物など） | 高次分類、絞り込み         |
| `23.61`      | 類義語グループ（例：「春」と「秋」）     | 並び替え、グループ表示     |
| `23.6147...` | 文脈に応じた意味差異                     | 多義語処理、詩的効果の抽出 |

---

## ✅ `streamtext.jsonl` の出力例

```json
{
  "form": "春",
  "lemma": "春",
  "pos": "NOUN",
  "fps-id": "23.48",
  "line": 12,
  "token_index": 3
}
```

---

## ✅ `cw` との統合（共起重み処理）

### 機能概要

- 入力形式：`streamtext.jsonl`
- 使用キー：`-k fps-id`
- 桁指定：`-digit 6` → `fps-id` の先頭6桁が一致する語を同語とみなす
- 出力形式：`fps-id1 fps-id2 weight`

### 重み計算式：

```math
cw(t1, t2) = ctf × √(idf_1 × idf_2)
```

---

## ✅ 利点

### 古典語コーパスに適した構成

- ✅ fastText のような大規模訓練は不要
- ✅ コーパス内の語共起情報のみで完結
- ✅ 伊勢・土佐・古今など、1万〜5万語規模で十分に対応可能

### 可読性と拡張性

- ✅ 数値IDでありながら人間にも読める
- ✅ 桁数調整によって抽象度の制御が容易
- ✅ 隠れた構造や階層がそのまま数値に反映される

### 可視化との親和性

- ✅ グラフ構造により意味的なまとまりが見える
- ✅ `graphviz` による視覚検証が容易

---

## ✅ 将来的展望

- `kfps` ツールキットの構築：共起ベクトル → PCA → FPS-ID
- `fpsid2text.tsv` の整備：FPS-ID → 語の逆引き辞書
- `fpsid-cluster-browser` の構築：GUIで意味クラスタを視覚探索
- `wlsp` との比較分析：自動ラベリング vs 手設計の意味体系

---

> **FPS-ID = Frequency-based PCA Semantic ID**
> 小規模詩的・古典語テキストのための、軽量・可読・意味順序性を持つ語ID方式。

---
